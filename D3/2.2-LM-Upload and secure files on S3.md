Got it ✅
I’ll create a **detailed hands-on lab** for *“Upload and Secure Files on Amazon S3”* that includes **pre-requisites, step-by-step setup, and security best practices**.
This will be a **complete guided lab** so learners can follow it end-to-end without missing any step.

---

## **Lab Title**: Upload and Secure Files on Amazon S3

### **Lab Objective**

By the end of this lab, you will:

* Create an Amazon S3 bucket with proper security configurations.
* Upload files to S3 using both the AWS Console and AWS CLI.
* Apply IAM policies and S3 bucket policies for controlled access.
* Enable encryption at rest and in transit.
* Test access restrictions and confirm security.

---

## **1. Pre-Requisites**

Before starting the lab, ensure you have:

### **AWS Account**

* An active AWS account (Free Tier eligible is fine).
* Access to AWS Management Console.

### **IAM User**

* An IAM user with programmatic and console access.
* Permissions required:

  * `AmazonS3FullAccess` (for learning purposes — in production use principle of least privilege).
  * `IAMReadOnlyAccess` (to review policies).
* Access Key & Secret Key for AWS CLI.

### **Local Machine Setup**

* **AWS CLI** installed:

  ```bash
  aws --version
  ```

  If not installed: [AWS CLI Installation Guide](https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html)

* **Configured AWS CLI** profile:

  ```bash
  aws configure
  ```

  Enter:

  * AWS Access Key ID
  * AWS Secret Access Key
  * Default region (e.g., `us-east-1`)
  * Output format (e.g., `json`)

* **Test AWS CLI setup**:

  ```bash
  aws s3 ls
  ```

* A **sample file** for upload, e.g.,

  ```bash
  echo "Hello S3 Lab!" > sample.txt
  ```

---

## **2. Lab Steps**

### **Step 1 – Create an S3 Bucket**

**Via Console:**

1. Go to **AWS Console → S3**.
2. Click **Create bucket**.
3. Enter a unique name (e.g., `my-secure-bucket-lab-<your-name>`).
4. Choose region (e.g., `us-east-1`).
5. **Uncheck** "Block all public access" (only if testing public access — for security, keep it checked).
6. Enable **Bucket Versioning** for file recovery.
7. Click **Create bucket**.

**Via CLI:**

```bash
aws s3 mb s3://my-secure-bucket-lab-yourname --region us-east-1
```

---

### **Step 2 – Enable Encryption at Rest**

**Console:**

1. Go to your bucket → **Properties**.
2. Under **Default encryption**, choose:

   * SSE-S3 (AES-256) or SSE-KMS for more control.
3. Save changes.

**CLI Example (SSE-S3):**

```bash
aws s3api put-bucket-encryption \
    --bucket my-secure-bucket-lab-yourname \
    --server-side-encryption-configuration '{
        "Rules":[{
            "ApplyServerSideEncryptionByDefault":{
                "SSEAlgorithm":"AES256"
            }
        }]
    }'
```

---

### **Step 3 – Upload a File**

**Console:**

1. Go to your bucket → **Upload**.
2. Add `sample.txt`.
3. Click **Upload**.

**CLI (with encryption)**:

```bash
aws s3 cp sample.txt s3://my-secure-bucket-lab-yourname/ \
    --sse AES256
```

---

### **Step 4 – Secure Access with IAM Policy**

**Create a restricted IAM policy** (only upload & list objects):

```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "AllowListObjects",
            "Effect": "Allow",
            "Action": [
                "s3:ListBucket"
            ],
            "Resource": "arn:aws:s3:::my-secure-bucket-lab-yourname"
        },
        {
            "Sid": "AllowUploadObjects",
            "Effect": "Allow",
            "Action": [
                "s3:PutObject"
            ],
            "Resource": "arn:aws:s3:::my-secure-bucket-lab-yourname/*"
        }
    ]
}
```

1. Create this policy in **IAM → Policies → Create Policy**.
2. Attach it to your IAM user.

---

### **Step 5 – Secure Access with a Bucket Policy**

Example: Allow only your IAM user to access objects:

```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "AllowAccessToSpecificUser",
            "Effect": "Allow",
            "Principal": {
                "AWS": "arn:aws:iam::<ACCOUNT_ID>:user/<USERNAME>"
            },
            "Action": "s3:*",
            "Resource": [
                "arn:aws:s3:::my-secure-bucket-lab-yourname",
                "arn:aws:s3:::my-secure-bucket-lab-yourname/*"
            ]
        }
    ]
}
```

Apply in **S3 → Permissions → Bucket Policy**.

---

### **Step 6 – Enable Encryption in Transit**

* S3 supports HTTPS automatically.
* Enforce HTTPS in bucket policy:

```json
{
    "Sid": "EnforceTLS",
    "Effect": "Deny",
    "Principal": "*",
    "Action": "s3:*",
    "Resource": [
        "arn:aws:s3:::my-secure-bucket-lab-yourname",
        "arn:aws:s3:::my-secure-bucket-lab-yourname/*"
    ],
    "Condition": {
        "Bool": {
            "aws:SecureTransport": "false"
        }
    }
}
```

---

### **Step 7 – Test Access**

* **Correct user + HTTPS** → Upload succeeds.
* **Wrong user** → Access denied.
* **HTTP attempt** (using custom client) → Denied.

---

### **Step 8 – Cleanup**

```bash
aws s3 rm s3://my-secure-bucket-lab-yourname --recursive
aws s3 rb s3://my-secure-bucket-lab-yourname
```

---

## **3. Learning Points**

* How to use AWS Console & CLI for S3.
* Applying encryption at rest and in transit.
* Using IAM & bucket policies for security.
* Testing security controls.


## **Extended Lab – Secure File Sharing with Pre-signed URLs**

### **Step 9 – Create a Pre-signed URL (Temporary Access)**

Pre-signed URLs allow you to give temporary, secure access to an object without making the bucket public.

#### **Generate via CLI**

```bash
aws s3 presign s3://my-secure-bucket-lab-yourname/sample.txt \
    --expires-in 600
```

* `600` = URL valid for 10 minutes.
* Output: A signed HTTPS URL that can be shared.

#### **Test the Pre-signed URL**

* Paste it into your browser or use `curl`:

```bash
curl "<PRESIGNED_URL>"
```

* You should be able to download the file until the URL expires.

#### **Security Notes**

* Pre-signed URLs bypass bucket policies temporarily.
* Expiry time should be minimal for sensitive files.
* Only authorized IAM users can generate them.


